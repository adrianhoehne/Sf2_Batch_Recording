#!/bin/bash

### Values ##################################################

user_values=("0" "0" "0" "0" "0" "0" "0" "0" "0" "0" )
bank_effect=("leer" "leer" "leer" "leer" "leer" "leer" "leer" "leer" "leer" "leer")

### Decription ##############################################


### Function preload ########################################
function preload {
EFFECTS_FOLDER='effect_desc/'
ls $EFFECTS_FOLDER > /var/tmp/effect_maker

cat -n /var/tmp/effect_maker
printf '\nChoose an effect in integer :'
read CHOOSE_EFFECT
EFFECT_NAME=$(tail +$CHOOSE_EFFECT /var/tmp/effect_maker | head -1)

bank_effect[$1-1]=$EFFECT_NAME

EFFECT=( $( cat $EFFECTS_FOLDER""$EFFECT_NAME ) )

# reminder
# effect_options=()
# user_values=(0 0 0 0 0 0 0 0 0 0 )
# max_values=()
# step_size=()

index="${#EFFECT[*]}"
i=0
y=0
while [[ "$i" -lt "$index" ]]; do
	effect_options[$y]="${EFFECT[$i]}"
	max_values[$y]="${EFFECT[$i+1]}"
	step_size[$y]="${EFFECT[$i+2]}"
	user_values[$y]="${EFFECT[$i+3]}"
	i=$[$i+4]
	y=$[$y+1]
done

unset i
unset y
unset index
unset CHOOSE_EFFECT
}
### Function gui_balken #####################################
function gui_balken {
if [[ "$1" -lt 10 ]]; then 
	printf "  "
elif [[ "$1" -lt 100 ]]; 
	then printf " "
fi
printf " $1  $2 Step size $3"
printf "#\n"
}

### Function gui_text #####################################
function gui_text {
pos=$(echo "$1" |wc -m )
max=20
printf "#  "$1
while [[ "$pos" -lt "$max" ]]; do
	printf " "
	pos=$[$pos+1]
done
unset pos
unset max
}

### Function gui_bank ########################################
function gui_bank {
i=0
index=10
while [[ "$i" -lt "$index" ]]; do
	y=$[$i+1]
	if [[ "$y" -gt 9 ]]; then
		transport="$y"'.'"${bank_effect[$i]}"
	else
		transport="0$y"'.'"${bank_effect[$i]}"
	fi
	gui_text $transport
	if [[ "$i" = 3 || "$i" = 7 ]]; then
		printf "\n"
	fi
	i=$[$i+1]
done
printf "\n"
unset i
unset y
unset transport
}

### Function line and linebreak ##############################
function line {
        i=0
        while [[ "$i" -lt 100 ]]; do
                printf "#"
                i=$[$i+1]
        done
        printf "\n"
	unset i
}
function lbr {
	i=0
	printf "#"
        while [[ "$i" -lt 98 ]]; do
                printf " "
                i=$[$i+1]
        done
	printf "#\n"
	unset i
}
### Function header ########################################
function header {
	line
	lbr
	gui_bank
	lbr
	line
}
### Function footer ########################################

function footer {
	line
	lbr
	printf " $error1 \n"
	lbr
	line
}

### Function build gui #####################################

function build_gui {
lbr
# reminder
# effect_options=()
# user_values=(0 0 0 0 0 0 0 0 0 0 )
# max_values=()
# step_size=(

i=0
index="${#effect_options[*]}"
while [[ "$i" -lt "$index" ]]; do
	gui_text "${effect_options[$i]}"
	gui_balken "${user_values[$i]}" "${max_values[$i]}" "${step_size[$i]}"
	i=$[$i+1]
done
error1=${effect_options}' '"$index"
lbr
unset i
unset index
}


### Function sox_play #####################################
function sox_play {
temp_effect="$EFFECT_NAME"
i=0
index="${#effect_options[*]}" 
while [[ "$i" -lt "$index" ]]; do
	temp_effect="$temp_effect"' '"${user_values[$i]}"
	i=$[$i+1]
done
echo $temp_effect > temp.effect
killall play
play -q test.wav $( cat temp.effect) &

}

### Function KeyPress #####################################
# reminder
# effect_options=()
# user_values=(0 0 0 0 0 0 0 0 0 0 )
# max_values=()
# step_size=(

function keypress {
  if [[ "$1" = "q" ]]; then stop=1
elif [[ "$1" = "p" ]]; then sox_play
elif [[ "$1" = 1 ]]; then preload 1
elif [[ "$1" = 2 ]]; then preload 2
elif [[ "$1" = 3 ]]; then preload 3
elif [[ "$1" = 4 ]]; then preload 4
elif [[ "$1" = 5 ]]; then preload 5
elif [[ "$1" = 6 ]]; then preload 6
elif [[ "$1" = 7 ]]; then preload 7
elif [[ "$1" = 8 ]]; then preload 8
elif [[ "$1" = 9 ]]; then preload 9
elif [[ "$1" = 10 ]]; then preload 10
elif [[ "$1" = "a" && "${user_values[0]}" -lt "${max_values[0]}" ]]; then user_values[0]=$[${user_values[0]}+${step_size[0]}] 
elif [[ "$1" = "y" && "${user_values[0]}" -gt "0" ]]; then user_values[0]=$[${user_values[0]}-${step_size[0]}] 
elif [[ "$1" = "s" && "${user_values[1]}" -lt "${max_values[1]}" ]]; then user_values[1]=$[${user_values[1]}+${step_size[1]}]
elif [[ "$1" = "x" && "${user_values[1]}" -gt "0" ]]; then user_values[1]=$[${user_values[1]}-${step_size[1]}]
elif [[ "$1" = "d" && "${user_values[2]}" -lt "${max_values[2]}" ]]; then user_values[2]=$[${user_values[2]}+${step_size[2]}]
elif [[ "$1" = "c" && "${user_values[2]}" -gt "0" ]]; then user_values[2]=$[${user_values[2]}-${step_size[2]}]
elif [[ "$1" = "f" && "${user_values[3]}" -lt "${max_values[3]}" ]]; then user_values[3]=$[${user_values[3]}+${step_size[3]}]
elif [[ "$1" = "v" && "${user_values[3]}" -gt "0" ]]; then user_values[3]=$[${user_values[3]}-${step_size[3]}]
elif [[ "$1" = "g" && "${user_values[4]}" -lt "${max_values[4]}" ]]; then user_values[4]=$[${user_values[4]}+${step_size[4]}]
elif [[ "$1" = "b" && "${user_values[4]}" -gt "0" ]]; then user_values[4]=$[${user_values[4]}-${step_size[4]}]
elif [[ "$1" = "h" && "${user_values[5]}" -lt "${max_values[5]}" ]]; then user_values[5]=$[${user_values[5]}+${step_size[5]}]
elif [[ "$1" = "n" && "${user_values[5]}" -gt "0" ]]; then user_values[5]=$[${user_values[5]}-${step_size[5]}]
elif [[ "$1" = "j" && "${user_values[6]}" -lt "${max_values[6]}" ]]; then user_values[6]=$[${user_values[6]}+${step_size[6]}]
elif [[ "$1" = "m" && "${user_values[6]}" -gt "0" ]]; then user_values[6]=$[${user_values[6]}-${step_size[6]}]
elif [[ "$1" = "k" && "${user_values[7]}" -lt "${max_values[7]}" ]]; then user_values[7]=$[${user_values[7]}+${step_size[7]}]
elif [[ "$1" = "," && "${user_values[7]}" -gt "0" ]]; then user_values[7]=$[${user_values[7]}-${step_size[7]}]
elif [[ "$1" = "l" && "${user_values[8]}" -lt "${max_values[8]}" ]]; then user_values[8]=$[${user_values[8]}+${step_size[8]}]
elif [[ "$1" = "." && "${user_values[8]}" -gt "0" ]]; then user_values[8]=$[${user_values[8]}-${step_size[8]}]
elif [[ "$1" = "รถ" &&"${user_values[9]}" -lt "${max_values[9]}" ]]; then user_values[9]=$[${user_values[9]}+${step_size[9]}]
elif [[ "$1" = "-" && "${user_values[9]}" -gt "0" ]]; then user_values[9]=$[${user_values[9]}-${step_size[9]}]
fi
}

### Working zone ##########################################
clear
stop=0
while [[ "$stop" = 0 ]]; do
	header
	build_gui
	footer
	read -n 1 key
	keypress $key
	clear
done
